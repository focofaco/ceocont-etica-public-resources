name: "Dependency Review"

# Scans PRs for vulnerable or malicious dependencies
# Integrates with GitHub Advisory Database
# See: https://docs.github.com/en/code-security/supply-chain-security/understanding-your-software-supply-chain/about-dependency-review

on:
  pull_request:
    paths:
      - 'requirements.txt'
      - '.github/workflows/*.yml'
      - '.github/dependabot.yml'

permissions:
  contents: read
  pull-requests: write

jobs:
  dependency-review:
    name: Review Dependencies
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Dependency Review
        uses: actions/dependency-review-action@v4
        with:
          # Fail on these severity levels
          fail-on-severity: moderate

          # Check for malicious packages
          warn-on-malicious: true

          # License compliance (optional - adjust as needed)
          # Deny licenses: GPL-3.0, AGPL-3.0 (copyleft)
          # deny-licenses: GPL-3.0, AGPL-3.0

          # Allow licenses: MIT, Apache-2.0, BSD-3-Clause
          # allow-licenses: MIT, Apache-2.0, BSD-3-Clause

          # Comment on PR with findings
          comment-summary-in-pr: always

          # Retry configuration for API calls
          retry-on-snapshot-warnings: true
          retry-on-snapshot-warnings-timeout: 120

      - name: Security Summary
        if: always()
        run: |
          echo "::notice::Dependency review completed. Check PR comments for details."
