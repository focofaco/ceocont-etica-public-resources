name: "Commit Message Validator Agent"

on:
  pull_request:
  push:
    branches: [ main ]

permissions:
  contents: read
  pull-requests: write

jobs:
  validate-commits:
    name: ‚úÖ Commit Validator Agent
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ü§ñ Validate Conventional Commits
        run: |
          echo "ü§ñ Agent validating commit messages..."

          # Conventional commit pattern: type(scope): description
          PATTERN='^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)(\(.+\))?!?: .{1,100}$'

          INVALID=0
          git log origin/main..HEAD --format=%s | while read -r msg; do
            if ! echo "$msg" | grep -Eq "$PATTERN"; then
              echo "‚ùå Invalid: $msg"
              INVALID=$((INVALID + 1))
            fi
          done

          [ $INVALID -eq 0 ] && echo "‚úÖ All commits follow conventional format"
