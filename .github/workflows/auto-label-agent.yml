name: "Auto-label Issues Agent"

on:
  issues:
    types: [ opened, edited ]

permissions:
  issues: write

jobs:
  auto-label:
    name: ğŸ·ï¸ Auto-label Agent
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.issue.title.toLowerCase();
            const body = context.payload.issue.body?.toLowerCase() || '';
            const text = title + ' ' + body;

            const labels = [];

            // Keywords mapping
            if (/\b(bug|erro|error|falha|broken)\b/.test(text)) labels.push('bug');
            if (/\b(feature|feat|funcionalidade|novo)\b/.test(text)) labels.push('enhancement');
            if (/\b(docs|documentaÃ§Ã£o|documentation)\b/.test(text)) labels.push('documentation');
            if (/\b(pergunta|question|dÃºvida|how)\b/.test(text)) labels.push('question');
            if (/\b(help|ajuda|suporte|support)\b/.test(text)) labels.push('help wanted');
            if (/\b(security|seguranÃ§a|vulnerabilidade|cve)\b/.test(text)) labels.push('security');

            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: labels
              });
              console.log(`ğŸ·ï¸ Added labels: ${labels.join(', ')}`);
            }
